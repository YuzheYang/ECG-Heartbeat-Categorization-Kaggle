import pandas as pdimport numpy as npimport matplotlib.pyplot as pltfrom keras.utils import np_utilsfrom tensorflow.keras.layers import *from tensorflow.keras import Modeldef normalization(data):    _range = np.max(data) - np.min(data)    return (data - np.min(data)) / _rangetrain_csv_file = r'F:\ECG-Data\mitbih_train.csv'all_train_data = pd.read_csv(train_csv_file)x_train = all_train_data.values[:, :-1].astype('float')x_train = normalization(x_train)y_train = all_train_data.values[:, -1].reshape(-1, 1)y_train = np_utils.to_categorical(y_train)test_csv_file = r'F:\ECG-Data\mitbih_test.csv'all_test_data = pd.read_csv(test_csv_file)x_test = all_test_data.values[:, :-1].astype('float')x_test = normalization(x_test)y_test = all_test_data.values[:, -1].reshape(-1, 1)y_test = np_utils.to_categorical(y_test)print(x_train.shape, y_train.shape, x_test.shape, y_test.shape)shape_inputdata = [187, 1]input_data = Input(shape_inputdata)x = Conv1D(filters=32, kernel_size=3, activation='relu')(input_data)x = MaxPooling1D()(x)x = Conv1D(filters=64, kernel_size=3, activation='relu')(x)x = MaxPooling1D()(x)x = Conv1D(filters=64, kernel_size=3, activation='relu')(x)x = BatchNormalization()(x)x = Flatten()(x)x = Dense(128, activation='relu')(x)x = Dropout(0.3)(x)x = Dense(64, activation='relu')(x)x = Dense(5, activation='softmax')(x)ECG_model = Model(input_data, x)ECG_model.compile('adam', loss='categorical_crossentropy', metrics=['CategoricalAccuracy'])history = ECG_model.fit(x_train, y_train, batch_size=64, validation_data=(x_test, y_test), epochs=20, verbose=1)ECG_model.save('ECG_mode-mitbih_train.h5')# 绘制训练 & 验证的准确率值plt.figure()plt.plot(history.history['categorical_accuracy'])plt.plot(history.history['val_categorical_accuracy'])plt.title('Model accuracy')plt.ylabel('Accuracy')plt.xlabel('Epoch')plt.legend(['Train', 'Test'], loc='upper left')plt.savefig('Acc.png')plt.figure()# 绘制训练 & 验证的损失值plt.plot(history.history['loss'])plt.plot(history.history['val_loss'])plt.title('Model loss')plt.ylabel('Loss')plt.xlabel('Epoch')plt.legend(['Train', 'Test'], loc='upper left')plt.savefig('Loss.png')